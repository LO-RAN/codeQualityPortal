Ext.ux.ManagedIFrame=function(){var B=Array.prototype.slice.call(arguments,0),C=Ext.get(B[0]),A=B[0];if(C&&C.dom&&C.dom.tagName=="IFRAME"){A=B[1]||{}}else{A=B[0]||B[1]||{};C=A.autoCreate?Ext.get(Ext.DomHelper.append(document.body,Ext.apply({tag:"iframe",src:(Ext.isIE&&Ext.isSecure)?Ext.SSL_SECURE_URL:""},A.autoCreate))):null}if(!C||C.dom.tagName!="IFRAME"){return C}!!C.dom.name.length||(C.dom.name=C.dom.id);this.addEvents({"domready":true,"documentloaded":true,"exception":true});if(A.listeners){this.listeners=A.listeners;Ext.ux.ManagedIFrame.superclass.constructor.call(this)}Ext.apply(C,this);C.addClass("x-managed-iframe");C.loadMask=Ext.apply({msg:"Loading..",msgCls:"x-mask-loading",maskEl:null,hideOnReady:true,enabled:!!A.loadMask},A.loadMask);C._eventName=Ext.isIE?"onreadystatechange":"onload";C._windowContext=null;C.dom[C._eventName]=C.loadHandler.createDelegate(C);if(document.addEventListener){Ext.EventManager.on(window,"DOMFrameContentLoaded",C.dom[C._eventName])}C.updateManager=new Ext.UpdateManager(C,true);C.updateManager.showLoadIndicator=A.showLoadIndicator||false;if(A.src){C.setSrc(A.src)}else{C.src=C.dom.src||null;var D=A.html||A.content||false;if(D){C.update(D)}}return C};Ext.extend(Ext.ux.ManagedIFrame,Ext.util.Observable,{setSrc:function(A,B,D){var C=A||this.src||(Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:"");if(Ext.isOpera){this.dom.src=""}this._windowContext=null;this._hooked=this._domReady=this._domFired=false;this._callBack=D||false;this.showMask();(function(){var F=typeof C=="function"?C()||"":C;try{this._frameAction=true;this.dom.src=F;this.checkDOM()}catch(E){this.fireEvent("exception",this,E)}}).defer(50,this);if(B!==true){this.src=C}return this},scriptRE:/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,update:function(B,A,D){A=A||this.getUpdateManager().loadScripts||false;B=Ext.DomHelper.markup(B||"");var C=this.getDocument();if(C){this._windowContext=null;this._callBack=D||false;this._frameAction=!!B.length;this._hooked=this._domReady=this._domFired=false;this.showMask();C.open();C.write(A===true?B:B.replace(this.scriptRE,""));C.close();if(this._frameAction){this.checkDOM()}else{if(D){D()}}}return this},_renderHook:function(){this._windowContext=null;this._hooked=false;try{return this.writeScript(String.format('(function(){parent.Ext.get("{0}")._windowContext={1};})();',this.dom.id,(Ext.isIE?"window":"{eval:function(s){return eval(s);}}")))&&this.domWritable()}catch(A){}return false},_windowContext:null,getDocument:function(){return this.getWindow().document},getWindow:function(){var A=this.dom;return A?A.contentWindow||window.frames[A.name]:window},print:function(){try{var B=this.getWindow();if(Ext.isIE){B.focus()}B.print()}catch(A){throw"print exception: "+(A.description||A.message||A)}},destroy:function(){this.removeAllListeners();if(this.dom){if(document.addEventListener){Ext.EventManager.un(window,"DOMFrameContentLoaded",this.dom[this._eventName])}this.dom[this._eventName]=null;if(this.dom.src){this.dom.src="javascript:false"}Ext.removeNode(this.dom)}this._windowContext=null;Ext.apply(this.loadMask,{masker:null,maskEl:null})},domWritable:function(){return !!this._windowContext},execScript:function(block,useDOM){try{if(this.domWritable()){return useDOM?this.writeScript(block):this._windowContext.eval(block)}else{throw"execScript:non-secure context"}}catch(ex){this.fireEvent("exception",this,ex)}},writeScript:function(E){try{var C,A,D=this.getDocument();if(D&&D.getElementsByTagName){if((C=D.getElementsByTagName("head")[0])&&(A=D.createElement("script"))){C.appendChild(A);A.type="text/javascript";A.text=E;return true}}}catch(B){}return false},loadFunction:function(D,B,C){var A=D.name||D;var D=D.fn||window[D];this.execScript(A+"="+D,B);if(C){this.execScript(A+"()")}},loadMask:{msg:"Loading..",msgCls:"x-mask-loading",maskEl:null,enabled:false},showMask:function(D,C,B){var A;if((A=this.loadMask)&&(A.enabled||B)){if(A._vis){return }A.masker||(A.masker=Ext.get(A.maskEl||this.dom.parentNode||this.wrap({tag:"div",style:{position:"relative"}})));A._vis=true;A.masker.mask(D||A.msg,C||A.msgCls)}},hideMask:function(B){var A;if((A=this.loadMask)&&(A.enabled||B)&&A.masker){if(!A._vis){return }if(!B&&(A.hideOnReady!==true&&this._domReady)){return }A._vis=false;A.masker.unmask()}},loadHandler:function(B){if(!this._frameAction){return }var A=(B&&typeof B.type!=="undefined"?B.type:this.dom.readyState);switch(A){case"loading":break;case"interactive":this.showMask();break;case"DOMFrameContentLoaded":if(this._domFired||(B&&B.target!==this.dom)){return }case"domready":if(this._domFired){return }if(this._domFired=this._hooked=this._renderHook()){this.fireEvent("domready",this)}case"domfail":this._domReady=true;this.hideMask();break;case"load":case"complete":if(!this._domFired){this.loadHandler({type:"domready"})}this._frameAction=false;this.fireEvent("documentloaded",this);this.hideMask(true);if(this._callBack){this._callBack(this)}break;default:}},checkDOM:function(D){var F=0,D=D||this.getWindow(),C=this,B=false;var A=100;var E=function(){try{B=false;var I=D.document,G;B=(I&&I.getElementsByTagName);B=B&&(G=I.getElementsByTagName("body")[0])&&!!G.innerHTML.length}catch(H){F=A}if(!C._frameAction||C._domReady){return }if(F++<A&&!B){setTimeout(arguments.callee,30);return }C.loadHandler({type:B?"domready":"domfail"})};if(!Ext.isOpera){E()}}});Ext.ux.ManagedIframePanel=Ext.extend(Ext.Panel,{defaultSrc:null,bodyStyle:{width:"100%",height:"100%"},iframeStyle:{overflow:"auto"},loadMask:false,animCollapse:false,autoScroll:false,closable:true,ctype:"Ext.ux.ManagedIframePanel",showLoadIndicator:false,unsupportedText:{tag:"span",cls:"x-error-noframes",html:"Inline frames are NOT enabled/supported by your browser."},initComponent:function(){var A=false;if(this.unsupportedText){A={html:Ext.DomHelper.markup(this.unsupportedText)}}this.bodyCfg||(this.bodyCfg={tag:"div",cls:"x-panel-body",children:[Ext.apply({tag:"iframe",frameBorder:0,cls:"x-managed-iframe",style:{width:"100%",height:"100%"}},A,Ext.isIE&&Ext.isSecure?{src:Ext.SSL_SECURE_URL}:false)]});Ext.ux.ManagedIframePanel.superclass.initComponent.call(this);this.addEvents({documentloaded:true,domready:true});if(this.defaultSrc){this.on("render",this.setSrc.createDelegate(this,[this.defaultSrc],0),this,{single:true})}},beforeDestroy:function(){if(this.rendered){if(this.tools){for(var A in this.tools){Ext.destroy(this.tools[A])}}if(this.header&&this.headerAsText){var B;if(B=this.header.child("span")){B.remove()}this.header.update("")}Ext.each(["iframe","header","topToolbar","bottomToolbar","footer","loadMask","body","bwrap"],function(C){if(this[C]){if(typeof this[C].destroy=="function"){this[C].destroy()}else{Ext.destroy(this[C])}this[C]=null;delete this[C]}},this)}Ext.ux.ManagedIframePanel.superclass.beforeDestroy.call(this)},onDestroy:function(){Ext.Panel.superclass.onDestroy.call(this)},onRender:function(B,A){Ext.ux.ManagedIframePanel.superclass.onRender.call(this,B,A);if(this.iframe=this.body.child("iframe.x-managed-iframe")){Ext.each([this[this.collapseEl],this.el],function(C){C.setVisibilityMode(Ext.Element[this.hideMode.toUpperCase()]||1).originalDisplay=(this.hideMode!="display"?"visible":"block")},this);if(this.loadMask){this.loadMask=Ext.apply({enabled:true,maskEl:this.body,hideOnReady:false},this.loadMask)}this.iframe=new Ext.ux.ManagedIFrame(this.iframe,{loadMask:this.loadMask,showLoadIndicator:this.showLoadIndicator});this.loadMask=this.iframe.loadMask;this.iframe.ownerCt=this;this.relayEvents(this.iframe,["documentloaded","domready","exception"]);if(this.iframeStyle){this.iframe.applyStyles(this.iframeStyle)}this.getUpdater().showLoadIndicator=this.showLoadIndicator||false}},afterRender:function(A){var B=this.html;delete this.html;Ext.ux.ManagedIframePanel.superclass.afterRender.call(this);if(B&&this.iframe){this.iframe.update(typeof B=="object"?Ext.DomHelper.markup(B):B)}},setSrc:function(B,C,E){var A=B||this.defaultSrc;if(typeof A=="object"){B=A.url||false;E=A.callback||false}var D=B||(Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:"");if(this.rendered&&this.iframe){this.iframe.setSrc(D,C,E)}if(C!==true){this.defaultSrc={url:D,callback:E}}this.saveState();return this},getState:function(){var A=(this.defaultSrc.url||this.defaultSrc);return Ext.apply(Ext.ux.ManagedIframePanel.superclass.getState.call(this)||{},{defaultSrc:typeof A=="function"?A():A})},getUpdater:function(){return this.rendered?(this.iframe||this.body).getUpdater():null},getFrame:function(){return this.rendered?this.iframe:null},getFrameWindow:function(){return this.rendered&&this.iframe?this.iframe.getWindow():null},getFrameDocument:function(){return this.rendered&&this.iframe?this.iframe.getDocument():null},load:function(B){var A;if(A=this.getUpdater()){if(B&&B.renderer){A.setRenderer(B.renderer);delete B.renderer}A.update.apply(A,arguments)}return this},doAutoLoad:function(){this.load(typeof this.autoLoad=="object"?this.autoLoad:{url:this.autoLoad})},onShow:function(){this.body.setVisible(true);Ext.ux.ManagedIframePanel.superclass.onShow.call(this)},onHide:function(){this.body.setVisible(false);Ext.ux.ManagedIframePanel.superclass.onHide.call(this)}});Ext.reg("iframepanel",Ext.ux.ManagedIframePanel);Ext.ux.ManagedIframePortlet=Ext.extend(Ext.ux.ManagedIframePanel,{anchor:"100%",frame:true,collapseEl:"bwrap",collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("iframeportlet",Ext.ux.ManagedIframePortlet)